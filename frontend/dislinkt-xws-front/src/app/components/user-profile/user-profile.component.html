<app-navigation></app-navigation>
<!-- MAIN CONTENT -->
<div class="background">
  <div class="row py-5">
    <div class="col-md-2"></div>

    <div class="col-md-8 d-flex justify-content-center">
      <div *ngIf="notFound && !editingMode">
        <h1>User not found!</h1>
      </div>
      <div class="main-box" *ngIf="!editingMode && !notFound">
        <img class="cover"
          src="https://images.ctfassets.net/7thvzrs93dvf/wpImage18643/2f45c72db7876d2f40623a8b09a88b17/linkedin-default-background-cover-photo-1.png?w=800&q=100">
        <div>
          <img class="profile-pic" src="https://via.placeholder.com/128/99ccff/0073e6.png?text=A">
        </div>
        <div class="btn-wrapper" *ngIf="this.currentUser.id == userId">
          <button class='pen-btn upload' (click)="editingMode = true"><i class="bi bi-pencil-fill pen"></i></button>
          <button class='btn btn-sm btn-primary rounded-5' data-bs-toggle="modal" data-bs-target="#requestsModal"
            *ngIf="this.currentUser.id == userId && this.userFromId.isPrivate">Follow
            Requests</button>
        </div>

        <div class="box mt-3">
          <div class="main-content">
            <div class="d-inline-flex">
              <h2 class="me-3">{{ fullName }}</h2>
              <button class="btn btn-md btn-primary rounded-5" *ngIf="showButton()"
                (click)="followUser()">Follow</button>
              <button disabled *ngIf="show()" class="btn btn-md btn-primary rounded-5 ms-2">Follow request sent</button>
              <button class="btn btn-md btn-danger rounded-5" *ngIf="showUnfollow()"
                (click)="unfollowUser()">Unfollow</button>
              <button class="btn btn-md btn-danger rounded-5 ms-3" *ngIf="showBlocked()"
                (click)="blockUser()">Block</button>
            </div>

            <h4 class="my-3">{{ currentUser.bio }}</h4>

            <div class="d-inline-flex mb-2" *ngIf="this.currentUser.id == userId">
              <button class="btn btn-warning tokenbutton" (click)="generateApiToken()"> Get API Token</button>
              <h6>{{apitoken}}</h6>
            </div>
          </div>
        </div>
        <div class="d-inline-flex px-2 mb-0 followers">
          <h6>{{currentUser.followers.length}} <span class="followers-text">Followers</span></h6>
          <h6>{{currentUser.followedUsers.length}} <span class="followers-text">Following</span></h6>
        </div>

        <hr class=" text-muted mb-4">

        <div class="experience" *ngIf="!isPrivate()">
          <h3>Experience</h3>

          <div class="experience-list">
            <h6 class="mt-4">EDUCATION</h6>
            <hr style="width: 300px; margin-left: 1.5rem; margin-top: 0; margin-bottom: 5px;">
            <ul class="style_1">
              <li *ngFor="let e of education" style="font-weight: 600;">{{e.establishmentName}}<br />
                <small class="ms-4">
                  {{e.start | date: 'longDate'}} - {{e.end | date: 'longDate'}}
                </small>
              </li>
            </ul>
          </div>

          <div class="experience-list" *ngIf="workExperience.length !== 0">
            <h6 class="mt-4">WORK EXPERIENCE</h6>
            <hr style="width: 300px; margin-left: 1.5rem; margin-top: 0; margin-bottom: 5px;">
            <ul class="style_1">
              <li *ngFor="let e of workExperience" style="font-weight: 600;">{{e.establishmentName}}<br />
                <small class="ms-4">
                  {{e.start | date: 'longDate'}} - {{e.end | date: 'longDate'}}
                </small>
              </li>
            </ul>
          </div>
        </div>

        <div class="experience" *ngIf="!isPrivate()">
          <h3>Personal information</h3>
          <hr>
          <div class="personal-info">
            <ul class="style_1">
              <li style="font-weight: 600;">Email<br />
                <small class="ms-4">
                  {{currentUser.email}}
                </small>
              </li>
              <li style="font-weight: 600;">Phone Number<br />
                <small class="ms-4">
                  {{currentUser.phoneNumber}}
                </small>
              </li>
              <li style="font-weight: 600;">Gender<br />
                <small class="ms-4">
                  {{currentUser.userGender}}
                </small>
              </li>
              <li style="font-weight: 600;" *ngIf="interests.length !== 0">Interests<br />
                <div class="mt-2 ms-4">
                  <mat-chip-list aria-label="Fish selection">
                    <mat-chip *ngFor="let interest of interests">{{interest.name}}</mat-chip>
                  </mat-chip-list>
                </div>
              </li>
              <li style="font-weight: 600;" *ngIf="skills.length !== 0">Skills<br />
                <div class="mt-2 ms-4">
                  <mat-chip-list aria-label="Fish selection">
                    <mat-chip *ngFor="let skill of skills">{{skill.name}}</mat-chip>
                  </mat-chip-list>
                </div>
              </li>
            </ul>
          </div>
        </div>

      </div>

      <div class="edit-info main-box" *ngIf="editingMode && !notFound">
        <img class=" cover"
          src="https://images.ctfassets.net/7thvzrs93dvf/wpImage18643/2f45c72db7876d2f40623a8b09a88b17/linkedin-default-background-cover-photo-1.png?w=800&q=100">
        <div>
          <img class="profile-pic" src="https://via.placeholder.com/128/99ccff/0073e6.png?text=A">
        </div>
        <div class="btn-wrapper">
          <button class='pen-btn upload' (click)="editingMode = false"><i class="fas fa-times pen"></i></button>
          <button class='pen-btn upload' (click)="updateProfile()"><i class="fas fa-check pen"></i></button>
        </div>

        <div class="box mt-3">
          <div class="main-content">
            <div class="form-floating mb-4">
              <input type="text" class="form-control" placeholder="Full name" [(ngModel)]="currentUser.fullName">
              <label for="floatingInput">Full name</label>
            </div>
            <div class="form-floating mb-4">
              <input type="text" class="form-control mb-4" placeholder="Username" [(ngModel)]="currentUser.username">
              <label for="floatingInput">Username</label>
            </div>
            <div class="form-floating mb-4">
              <textarea class="form-control mb-4" placeholder="Biography" [(ngModel)]="currentUser.bio"></textarea>
              <label for="floatingInput">Biography</label>
            </div>
          </div>
        </div>
        <div class="d-inline-flex px-2 mb-0 followers">
          <h6>{{currentUser.followers.length}} <span class="followers-text">Followers</span></h6>
          <h6>{{currentUser.followedUsers.length}} <span class="followers-text">Following</span></h6>
        </div>

        <hr class=" text-muted mb-4">

        <div class="experience">
          <h3>Experience</h3>

          <div>
            <h6 class="mt-4">EDUCATION <button class="btn" data-bs-toggle="modal" data-bs-target="#educationModal"><i
                  class="bi bi-plus-circle-fill mt-1"></i></button>
              <button class="btn" (click)="editEducation = true"><i class="bi bi-pencil-fill mt-1"></i></button>
            </h6>
            <hr style="width: 300px; margin-left: 1.5rem; margin-top: 0; margin-bottom: 15px;">
            <div class="experience-list" *ngIf="!editEducation">
              <ul class="style_1">
                <li *ngFor="let e of education" style="font-weight: 600;">{{e.establishmentName}}<br />
                  <small class="ms-4">
                    {{e.start | date: 'longDate'}} - {{e.end | date: 'longDate'}}
                  </small>
                </li>
              </ul>
            </div>
            <ul style="list-style: none;" *ngIf="editEducation">
              <li *ngFor="let e of education" class="experience-edit">
                <div class="d-inline-flex mb-2">
                  <div class="form-floating me-2">
                    <input type="text" class="form-control experience-edit" placeholder="Establishment name"
                      [(ngModel)]="e.establishmentName">
                    <label for="floatingInput">Establishment name</label>
                  </div>
                  <p class="mt-3">&rarr;</p>
                  <div class="form-floating mx-2">
                    <input type="date" class="form-control dates" placeholder="Start" [(ngModel)]="e.start">
                    <label for="floatingInput">Start</label>
                  </div>
                  <p class="mt-3">-</p>
                  <div class="form-floating ms-2">
                    <input type="date" class="form-control dates" placeholder="End" [(ngModel)]="e.end">
                    <label for="floatingInput">End</label>
                  </div>
                  <button class="btn ms-1" (click)="updateExp(e)"><i class="bi bi-check-all"></i></button>
                  <button class="btn" (click)="deleteEducation(e)"><i class="bi bi-trash-fill"></i></button>
                </div>
              </li>
            </ul>
          </div>

          <div>
            <h6 class="mt-4">WORK EXPERIENCE
              <button class="btn" data-bs-toggle="modal" data-bs-target="#workModal"><i
                  class="bi bi-plus-circle-fill mt-1"></i></button>
              <button class="btn" (click)="editWork = true"><i class="bi bi-pencil-fill mt-1"></i></button>
            </h6>
            <hr style="width: 300px; margin-left: 1.5rem; margin-top: 0; margin-bottom: 15px;">
            <div class="experience-list" *ngIf="!editWork">
              <ul class="style_1">
                <li *ngFor="let e of workExperience" style="font-weight: 600;">{{e.establishmentName}}<br />
                  <small class="ms-4">
                    {{e.start | date: 'longDate'}} - {{e.end | date: 'longDate'}}
                  </small>
                </li>
              </ul>
            </div>
            <ul style="list-style: none;" *ngIf="editWork">
              <li *ngFor="let e of workExperience" class="experience-edit mb-2">
                <div class="d-inline-flex mb-2">
                  <div class="form-floating me-2">
                    <input type="text" class="form-control experience-edit workName" placeholder="Establishment name"
                      [(ngModel)]="e.establishmentName">
                    <label for="floatingInput">Establishment name</label>
                  </div>
                  <div class="form-floating me-2">
                    <input type="text" class="form-control experience-edit position" placeholder="Establishment name"
                      [(ngModel)]="e.role">
                    <label for="floatingInput">Position</label>
                  </div>
                  <p class="mt-3">&rarr;</p>
                  <div class="form-floating mx-2">
                    <input type="date" class="form-control dates" placeholder="Start" [(ngModel)]="e.start">
                    <label for="floatingInput">Start</label>
                  </div>
                  <p class="mt-3">-</p>
                  <div class="form-floating ms-2">
                    <input type="date" class="form-control dates" placeholder="End" [(ngModel)]="e.end">
                    <label for="floatingInput">End</label>
                  </div>
                  <button class="btn ms-1" (click)="updateExp(e)"><i class="bi bi-check-all"></i></button>
                  <button class="btn" (click)="deleteExp(e)"><i class="bi bi-trash-fill"></i></button>
                </div>
              </li>
            </ul>
          </div>
        </div>

        <div class="experience">
          <h3>Personal information</h3>
          <hr>
          <div class="personal-info">
            <ul class="style_1">
              <li style="font-weight: 600;">Email<br />
                <input type="email" class="form-control experience-edit ms-2 mt-2" placeholder="Email"
                  [(ngModel)]="currentUser.email">
              </li>
              <li style="font-weight: 600;">Phone Number<br />
                <input type="text" class="form-control experience-edit ms-2 mt-2" placeholder="Phone"
                  [(ngModel)]="currentUser.phoneNumber">
              </li>
              <li style="font-weight: 600;">Gender<br />
                <div class="form-check form-check-inline ms-2 mt-2">
                  <input class="form-check-input" type="radio" name="genderOptions" id="male" value="MALE"
                    [(ngModel)]="currentUser.userGender" />
                  <label class="form-check-label" for="male">Male</label>
                </div>
                <div class="form-check form-check-inline ms-2 mt-2">
                  <input class="form-check-input" type="radio" name="genderOptions" id="female" value="FEMALE"
                    [(ngModel)]="currentUser.userGender" />
                  <label class="form-check-label" for="female">Female</label>
                </div>
              </li>
              <li style="font-weight: 600;">Account privacy<br />
                <div class="row ms-2 mt-2">
                  <select class="form-select" [(ngModel)]="currentUser.isPrivate">
                    <option value=true>Private</option>
                    <option value=false>Public</option>
                  </select>
                </div>
              </li>
              <li style="font-weight: 600;">Interests<br />
                <div class="mt-1 ms-2 w-100">
                  <mat-form-field class="example-chip-list w-100">
                    <mat-label>Interests</mat-label>
                    <mat-chip-list #interestList aria-label="Skillls">
                      <mat-chip *ngFor="let interest of interests" (removed)="removeInterest(interest)">
                        {{interest.name}}
                        <button matChipRemove>
                          <mat-icon>cancel</mat-icon>
                        </button>
                      </mat-chip>
                      <input placeholder="New interest..." [matChipInputFor]="interestList"
                        [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                        (matChipInputTokenEnd)="addInterest($event)">
                    </mat-chip-list>
                  </mat-form-field>
                </div>
              </li>
              <li style="font-weight: 600;">Skills<br />
                <div class="mt-1 ms-2 w-100">
                  <mat-form-field class="example-chip-list w-100">
                    <mat-label>Skills</mat-label>
                    <mat-chip-list #skillList aria-label="Skillls">
                      <mat-chip *ngFor="let skill of skills" (removed)="removeSkill(skill)">
                        {{skill.name}}
                        <button matChipRemove>
                          <mat-icon>cancel</mat-icon>
                        </button>
                      </mat-chip>
                      <input placeholder="New skill..." [matChipInputFor]="skillList"
                        [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                        (matChipInputTokenEnd)="addSkill($event)">
                    </mat-chip-list>
                  </mat-form-field>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-2"></div>
  </div>
</div>
<!-- END MAIN CONTENT -->


<div class="modal fade" id="educationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true" data-bs-backdrop="false">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add education</h5>
        <button type="button" class="close btn" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" style="font-size: 18px;">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="d-flex row justify-content-center">
          <mat-form-field class="w-75">
            <mat-label>Establishment name</mat-label>
            <input matInput type="text" [(ngModel)]="expName">
          </mat-form-field>
        </div>
        <div class="d-flex row justify-content-center">
          <mat-form-field class="w-75" style="z-index: 999;">
            <mat-label>Enter a date range</mat-label>
            <mat-date-range-input [rangePicker]="picker">
              <input matStartDate name="start" [(ngModel)]="startExp">
              <input matEndDate name="end" [(ngModel)]="endExp">
            </mat-date-range-input>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
          </mat-form-field>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger rounded-5 me-3" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary rounded-5" data-bs-dismiss="modal"
          (click)="addExperience()">Save</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="workModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true" data-bs-backdrop="false">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add work experience</h5>
        <button type="button" class="close btn" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" style="font-size: 18px;">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="d-flex row justify-content-center">
          <mat-form-field class="w-75">
            <mat-label>Establishment name</mat-label>
            <input matInput type="text" [(ngModel)]="expName">
          </mat-form-field>
        </div>
        <div class="d-flex row justify-content-center">
          <mat-form-field class="w-75">
            <mat-label>Position</mat-label>
            <input matInput type="text" [(ngModel)]="expRole">
          </mat-form-field>
        </div>
        <div class="d-flex row justify-content-center">
          <mat-form-field class="w-75" style="z-index: 999;">
            <mat-label>Enter a date range</mat-label>
            <mat-date-range-input [rangePicker]="picker2">
              <input matStartDate name="startWork" [(ngModel)]="startExp">
              <input matEndDate name="endWork" [(ngModel)]="endExp">
            </mat-date-range-input>
            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
            <mat-date-range-picker #picker2></mat-date-range-picker>
          </mat-form-field>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger rounded-5 me-3" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary rounded-5" data-bs-dismiss="modal"
          (click)="addWork()">Save</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="requestsModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true" data-bs-backdrop="false">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Follow requests</h5>
        <button type="button" class="close btn" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" style="font-size: 18px;">&times;</span>
        </button>
      </div>
      <div class="modal-body d-flex justify-content-center">
        <table>
          <tr *ngFor="let user of followRequests">
            <td>{{user.fullName}}</td>
            <td align="end"><button class="btn btn-primary rounded-5" data-bs-dismiss="modal"
                (click)="approveFollow(user.id)">Accept</button></td>
            <td align="end"><button class="btn btn-danger rounded-5" data-bs-dismiss="modal">Delete</button></td>
          </tr>
          <tr *ngIf="followRequests.length === 0">
            <td align="center">No new follow requests!</td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>
